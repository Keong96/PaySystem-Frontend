<!DOCTYPE html>
<html>
<head>
  <title>支付系统</title>
  <link rel="stylesheet" type="text/css" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.2.1/dist/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.6/dist/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.2.1/dist/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

</head>
<body>
    <div class="container mt-5">
        <div id="dashboard_header">
            <nav>
                <div class="nav nav-tabs" id="nav-tab" role="tablist">
                    <button class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-home" role="tab" aria-controls="nav-home" aria-selected="true">主页</button>
                    <button class="nav-item nav-link" id="nav-request-tab" data-toggle="tab" href="#nav-request" role="tab" aria-controls="nav-request" aria-selected="false">订单列表</button>
                    <button class="nav-item nav-link" id="nav-action-log-tab" data-toggle="tab" href="#nav-action-log" role="tab" aria-controls="nav-action-log" aria-selected="false">操作日志</button>
                    <button class="nav-item nav-link" id="nav-alert-msg-tab" data-toggle="tab" href="#nav-alert-msg" role="tab" aria-controls="nav-alert-msg" aria-selected="false">警报系统</button>
                    <button class="nav-item nav-link" id="nav-setting-tab" data-toggle="tab" href="#nav-setting" role="tab" aria-controls="nav-setting" aria-selected="false">设置</button>
                </div>
            </nav>
        </div>
        <div id="dashboard_content">
            <div class="tab-content" id="nav-tabContent">
                <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab"></div>
                <div class="tab-pane fade" id="nav-request" role="tabpanel" aria-labelledby="nav-request-tab"></div>
                <div class="tab-pane fade" id="nav-action-log" role="tabpanel" aria-labelledby="nav-action-log-tab"></div>
                <div class="tab-pane fade" id="nav-alert-msg" role="tabpanel" aria-labelledby="nav-alert-msg-tab"></div>
                <div class="tab-pane fade" id="nav-setting" role="tabpanel" aria-labelledby="nav-setting-tab"></div>
            </div>
        </div>

        <div id="error-modal" class="modal" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-xl" role="document">
                <div class="modal-content">
                    <div class="modal-body">
                        <p id="error-modal-message"></p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" onclick="hideModal()">Okay</button>
                    </div>
                </div>
            </div>
        </div>

</body>

<script>
    
    const errorModal = document.getElementById('error-modal');
    const errorModalMessage = document.getElementById('error-modal-message');
    const token = localStorage.getItem('token');
    
    function hideModal() 
    {
        errorModal.style.display = 'none';
    }

    function showErrorModal(message) {
        errorModalMessage.innerHTML = message;
        errorModal.style.display = 'block';
    }

    axios.get("https://paysystem.onrender.com/request/get", {
            headers: { Authorization: `Bearer ${token}` }
          })
          .then(response => {
              var content = '<table class="table table-striped">';
              content += '<thead><tr><th scope="col">订单号</th><th scope="col">类型</th><th scope="col">发款地址</th><th scope="col">收款地址</th><th scope="col">数额</th><th scope="col">时间</th><th scope="col">状态</th><th colspan="2" scope="col" style="text-align:center">Action</th></tr></thead>';
              
              for(i = 0; i < response.data.length; i++)
              {
                  content += "<tr>";
                  content += "<td>"+response.data[i]['id']+"</td>";

                  var requestType = response.data[i]['request_type'];
                  if(requestType == 0)
                  {
                    content += "<td>汇款</td>";
                  }
                  else
                  {
                    content += "<td>提现</td>";
                  }
                  
                  content += "<td>"+response.data[i]['sender_address']+"</td>";
                  content += "<td>"+response.data[i]['receiver_address']+"</td>";
                  content += "<td>"+response.data[i]['amount']+"</td>";
                  content += "<td>"+response.data[i]['datetime']+"</td>";

                  var status = response.data[i]['status'];
                  switch(status)
                  {
                    case 0:
                        content += "<td style='color:blue;'>未结算</td>";
                        break;
                    case 1:
                        content += "<td style='color:red;'>已取消</td>";
                        break;
                    case 2:
                        content += "<td style='color:green;'>已结算</td>";
                        break;
                  }
                 
                  content += "</tr>";
              }
              content += "</table>";
              document.getElementById('nav-request').innerHTML = content;
          })
          .catch(error => {
              showErrorModal(error.response);
              console.log(error);
          });
</script>
</html>